/*
 * tcpclient.c
 *
 *  Created on: 2020. 5. 31.
 *      Author: eziya76@gmail.com
 */

#include "main.h"
#include "tcpclient.h"
#include "wizInterface.h"
#include "wizchip_conf.h"
#include "socket.h"

void WIZClientTask(void const *argument)
{
	int8_t ret;
	int16_t rcvLen;
	uint8_t rcvBuf[20];
	uint8_t bufSize[] = {2, 2, 2, 2};

	reg_wizchip_cs_cbfunc(WIZ_SPI_Select, WIZ_SPI_Deselect);
	reg_wizchip_spi_cbfunc(WIZ_SPI_RxByte, WIZ_SPI_TxByte);

	wizchip_init(bufSize, bufSize);
	wiz_NetInfo netInfo = {
			.mac 	= {0x00, 0x08, 0xdc, 0xab, 0xcd, 0xef},	// Mac address
			.ip 	= {192, 168, 1, 192},					// IP address
			.sn 	= {255, 255, 255, 0},					// Subnet mask
			.gw 	= {192, 168, 1, 1}};					// Gateway address
	wizchip_setnetinfo(&netInfo);
	wizchip_getnetinfo(&netInfo);

	ret = socket(0, Sn_MR_TCP, 5000, 0);
	if(ret < 0)
	{
		printf("socket failed.\n");
	}

	while(1);
}
